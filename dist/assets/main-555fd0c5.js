import{c as k,s as de,d as Q,b as ge,a as Pe}from"./camera-783e324d.js";const q=()=>0,U=t=>()=>Array(t).fill(0),te={i32:[4,4,"i32",q],u32:[4,4,"u32",q],f32:[4,4,"f32",q],"atomic<i32>":[4,4,"i32",q],"atomic<u32>":[4,4,"u32",q],"atomic<f32>":[4,4,"f32",q],"vec2<i32>":[8,8,"i32",U(2)],"vec2<u32>":[8,8,"u32",U(2)],"vec2<f32>":[8,8,"f32",U(2)],"vec3<i32>":[16,12,"i32",U(3)],"vec3<u32>":[16,12,"u32",U(3)],"vec3<f32>":[16,12,"f32",U(3)],"vec4<i32>":[16,16,"i32",U(4)],"vec4<u32>":[16,16,"u32",U(4)],"vec4<f32>":[16,16,"f32",U(4)],"mat2x2<f32>":[8,16,"f32",U(2*2)],"mat3x2<f32>":[8,24,"f32",U(3*2)],"mat4x2<f32>":[8,32,"f32",U(4*2)],"mat2x3<f32>":[16,32,"f32",U(2*3)],"mat3x3<f32>":[16,48,"f32",U(3*3)],"mat4x3<f32>":[16,64,"f32",U(4*3)],"mat2x4<f32>":[16,32,"f32",U(2*4)],"mat3x4<f32>":[16,48,"f32",U(3*4)],"mat4x4<f32>":[16,64,"f32",U(4*4)]},ce=(t,e,a)=>{if(t=t.replaceAll(/\s/g,""),te[t]!=null){let[r,s,n,c]=te[t];return e.align!=null&&(r=parseInt(e.align)),e.size!=null&&(s=parseInt(e.size)),{baseType:n,align:r,size:s,defaultValue:c}}else if(t in a){const r=a[t];let{align:s,size:n}=r;return e.align!=null&&(s=parseInt(e.align)),e.size!=null&&(n=parseInt(e.size)),{isStruct:!0,innerLayout:r,size:n,align:s,defaultValue:()=>me(a,r)}}else if(t.startsWith("array<")){const r=t.match(/array<(.*?),?(\d+)?>$/),[s,n,c]=r;if(n==null)return null;const o=ce(n,[],a),l=parseInt(c??"0"),m=o.align;let u=o.size;e.stride!=null&&(u=parseInt(e.stride));const p=u*l;return{isArray:!0,isFixedSize:l>0,elementTypeData:o,mult:l,size:p,align:m,stride:u,defaultValue:()=>Array(l).fill().map(P=>o.defaultValue())}}else return console.warn(`Unrecognized type ${t}.`),null},re=t=>{const e={};for(const a of t.split(",").filter(r=>r.length>0)){const r=a.match(/(\w+)(\((.*)\))?/),[s,n,c,o]=r;e[n]=o}return e},he=(t,e,a)=>{const r=[];let s=0;const n=e.trim().split(",").filter(m=>m.length>0).reduce((m,u,p)=>{if(p===0)return[u];const P=m[p-1];return P.split("<").length-P.split(">").length!==0?m[p-1]=`${P},${u}`:m.push(u),m},[]);for(const m of n){const u=m.match(/(@(.*?))? ?(\w+) ?: ?(@(.*?))? ?(.*)/),[p,P,h,d,g,f,b]=u,w=ce(b,re(f??""),a);if(w==null)return console.warn(`Skipping struct ${d}.`),null;s=Math.ceil(s/w.align)*w.align,r.push({attributes:re(h??""),identifier:d,type:b,...w,byteOffset:s}),s+=w.size}const c=s,o=Math.max(...r.map(m=>m.align)),l=Math.ceil(c/o)*o;return{identifier:t,fields:r,size:l,align:o}},ye=t=>{t=t.replace(/\s*\/\/.*$/gm,"").replace(/\/\*.*?\*\//gms,"").replace(/\s+/gm," ");const e={},a=Array.from(t.matchAll(/struct (\w+) ?\{(.*?)\};/g));for(const r of a){const[s,n,c]=r,o=he(n,c,e);o!=null&&(e[o.identifier]=o)}return e},me=(t,e)=>Object.fromEntries(e.fields.map(a=>[a.identifier,a.defaultValue()])),J=(t,e,a,r,s,n)=>{if(a==null){n&&console.warn(`Property missing from data: ${e.identifier}`);return}if(e.isArray){const c=e.isFixedSize?e.mult:a.length;for(let o=0;o<c;o++)J(t,e.elementTypeData,a[o],r,s+e.stride*o,n)}else if(e.isStruct)for(const c of e.innerLayout.fields)J(t,c,a[c.identifier],r,s+e.stride*i,n);else{const c=r[e.baseType],o=a[Symbol.iterator]==null?[Number(a)]:a;c.set(o,(s+(e.byteOffset??0))/4)}},be=(t,e)=>{const a=t.size;return Object.freeze({minSize:a,create:()=>me(e,t),toBuffer:(r,s,n=!1)=>{if(s==null){let o=t.size;const l=t.fields[t.fields.length-1];l.isArray&&l.identifier in r&&!l.isFixedSize&&(o+=l.stride*r[l.identifier].length),s=new ArrayBuffer(o)}const c={i32:new Int32Array(s),u32:new Uint32Array(s),f32:new Float32Array(s)};for(const o of t.fields)J(e,o,r[o.identifier],c,0,n);return s}})},V=Object.freeze({from:t=>{if(typeof t!="string")throw new Error("Input is not a string.");const e=ye(t);return Object.fromEntries(Object.entries(e).map(([a,r])=>[a,be(r,e)]))}}),$=async(t,e)=>{if(e==null)return t.createTexture({size:[1,1,1],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});const r=await(await fetch(e)).blob(),s=await createImageBitmap(r),n=[s.width,s.height,1],c=t.createTexture({size:n,format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});return t.queue.copyExternalImageToTexture({source:s,flipY:!0},{texture:c},n),c},ae=(t,e,a,r=1)=>t.createTexture({size:[...e,1],mipLevelCount:r,format:a,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT}),D=(t,e,a=1)=>t.createTexture({size:[...e,1],mipLevelCount:a,format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC|GPUTextureUsage.COPY_DST|GPUTextureUsage.STORAGE_BINDING}),F=async(t,e)=>{const r=await(await fetch(e)).text();return{code:r,module:t.createShaderModule({code:r})}},A=(t,e,a=null)=>{const r=t.createBuffer({size:e.minSize,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,mappedAtCreation:a!=null});return a!=null&&(e.toBuffer(a,r.getMappedRange()),r.unmap()),r},Te=(t,e)=>{const a=[e.length],r=t.createTexture({size:a,format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST}),s=new Uint8ClampedArray(e.map(n=>n.map(c=>c*255)).flat());return t.queue.writeTexture({texture:r},s,{},a),r},I=(t,e,a,r)=>t.createBindGroup({layout:e.getBindGroupLayout(a),entries:r.map(s=>s instanceof GPUBuffer?{buffer:s}:s).map((s,n)=>({binding:n,resource:s}))}),z=(t,e,a,r)=>({loaded:e??Promise.resolve(),build:a??((s,n)=>n),run:(s,n)=>{s.pushDebugGroup(`Pass "${t}"`),r==null||r(s,n),s.popDebugGroup()}}),we=async(t,e)=>(e=e.filter(a=>a!=null).map(a=>a(t)),await Promise.all(e.map(a=>a.loaded)),{steps:e,build:a=>e.reduce((r,s)=>s.build(a,r),null),run:(a,r)=>e.forEach(s=>s.run(a,r))}),se={box:0,circle:1},xe=2*3,Be=(t,e,a,r,s)=>{const n={...a,gridSize:s,density:r,showDebugView:a.effect==="none",rippleType:a.rippleTypeName in se?se[a.rippleTypeName]:-1,slantScale:1/(Math.abs(Math.sin(2*a.slant))*(Math.sqrt(2)-1)+1),slantVec:[Math.cos(a.slant),Math.sin(a.slant)],msdfPxRange:4};return A(t,e,n)},Ue=({config:t,device:e,timeBuffer:a})=>{const{mat4:r,vec3:s}=glMatrix,n=[$(e,t.glyphMSDFURL),$(e,t.glintMSDFURL),$(e,t.baseTextureURL),$(e,t.glintTextureURL),F(e,"src/matrix/shaders/wgsl/rainPass.wgsl")],c=t.volumetric&&t.effect!=="none"?t.density:1,o=[Math.floor(t.numColumns*c),t.numColumns],l=o[0]*o[1],m=t.volumetric?l:1,u=r.create();t.volumetric&&t.isometric?(r.rotateX(u,u,Math.PI*1/8),r.rotateY(u,u,Math.PI*1/4),r.translate(u,u,s.fromValues(0,0,-1)),r.scale(u,u,s.fromValues(1,1,2))):r.translate(u,u,s.fromValues(0,0,-1));const p=r.create(),P="rgba8unorm",h=e.createSampler({magFilter:"linear",minFilter:"linear"}),d={colorAttachments:[{loadOp:"clear",storeOp:"store"},{loadOp:"clear",storeOp:"store"}]};let g,f,b,w,y,T,S,Y,O,C,E;const x=(async()=>{const[M,G,_,L,R]=await Promise.all(n),X=V.from(R.code);g=Be(e,X.Config,t,c,o);const v=e.createBuffer({size:o[0]*X.IntroCell.minSize,usage:GPUBufferUsage.STORAGE}),ee=e.createBuffer({size:l*X.Cell.minSize,usage:GPUBufferUsage.STORAGE});f=X.Scene,b=A(e,f);const Z={operation:"add",srcFactor:"one",dstFactor:"one"};[w,y,T]=await Promise.all([e.createComputePipelineAsync({layout:"auto",compute:{module:R.module,entryPoint:"computeIntro"}}),e.createComputePipelineAsync({layout:"auto",compute:{module:R.module,entryPoint:"computeMain"}}),e.createRenderPipelineAsync({layout:"auto",vertex:{module:R.module,entryPoint:"vertMain"},fragment:{module:R.module,entryPoint:"fragMain",targets:[{format:P,blend:{color:Z,alpha:Z}},{format:P,blend:{color:Z,alpha:Z}}]}})]),S=I(e,w,0,[g,a,v]),Y=I(e,y,0,[g,a,ee,v]),O=I(e,T,0,[g,a,b,h,M.createView(),G.createView(),_.createView(),L.createView(),ee])})();return z("Rain",x,M=>{const G=M[0]/M[1];t.volumetric&&t.isometric?G>1?r.orthoZO(p,-1.5*G,1.5*G,-1.5,1.5,-1e3,1e3):r.orthoZO(p,-1.5,1.5,-1.5/G,1.5/G,-1e3,1e3):r.perspectiveZO(p,Math.PI/180*90,G,1e-4,1e3);const _=G>1?[1,G]:[1/G,1];return e.queue.writeBuffer(b,0,f.toBuffer({screenSize:_,camera:p,transform:u})),C==null||C.destroy(),C=ae(e,M,P),E==null||E.destroy(),E=ae(e,M,P),{primary:C,highPass:E}},(M,G)=>{const _=M.beginComputePass();_.setPipeline(w),_.setBindGroup(0,S),_.dispatchWorkgroups(Math.ceil(o[0]/32),1,1),_.end();const L=M.beginComputePass();if(L.setPipeline(y),L.setBindGroup(0,Y),L.dispatchWorkgroups(Math.ceil(o[0]/32),o[1],1),L.end(),G){d.colorAttachments[0].view=C.createView(),d.colorAttachments[1].view=E.createView();const R=M.beginRenderPass(d);R.setPipeline(T),R.setBindGroup(0,O),R.draw(xe*m,1,0,0),R.end()}})},ne=(t,e,a)=>Array(a).fill().map((r,s)=>D(t,e.map(n=>Math.floor(n*2**-s)))),oe=t=>t==null?void 0:t.forEach(e=>e.destroy()),le=(t,e)=>t[e].createView(),Se=t=>t.map(e=>e.createView()),Ce=({config:t,device:e})=>{const r=t.bloomSize,s=t.bloomStrength,n=2;if(!(r>0&&s>0)){const C=D(e,[1,1]);return z("No Bloom",null,(E,x)=>({...x,bloom:C}))}const o=[F(e,"src/matrix/shaders/wgsl/bloomBlur.wgsl"),F(e,"shaders/wgsl/bloomCombine.wgsl")],l=e.createSampler({magFilter:"linear",minFilter:"linear"});let m,u,p,P,h,d,g,f,b,w,y,T;const S=(async()=>{const[C,E]=await Promise.all(o);[m,f]=await Promise.all([e.createComputePipeline({layout:"auto",compute:{module:C.module,entryPoint:"computeMain"}}),e.createComputePipeline({layout:"auto",compute:{module:E.module,entryPoint:"computeMain"}})]);const x=V.from(C.code).Config;P=A(e,x,{bloomRadius:n,direction:[1,0]}),h=A(e,x,{bloomRadius:n,direction:[0,1]});const B=V.from(E.code).Config;b=A(e,B,{pyramidHeight:4,bloomStrength:s})})();return z("Bloom",S,(C,E)=>{T=C.map(B=>Math.floor(B*r)),oe(u),u=ne(e,T,4),oe(p),p=ne(e,T,4),y==null||y.destroy(),y=D(e,T),d=[],g=[];let x=E.highPass.createView();for(let B=0;B<4;B++){const N=le(u,B),M=le(p,B);d[B]=I(e,m,0,[P,l,x,N]),g[B]=I(e,m,0,[h,l,N,M]),x=N}return w=I(e,f,0,[b,l,...Se(p),y.createView()]),{...E,bloom:y}},(C,E)=>{if(!E)return;const x=C.beginComputePass();x.setPipeline(m);for(let B=0;B<4;B++){const N=[Math.ceil(Math.floor(T[0]*2**-B)/32),Math.floor(Math.floor(T[1]*2**-B)),1];x.setBindGroup(0,d[B]),x.dispatchWorkgroups(...N),x.setBindGroup(0,g[B]),x.dispatchWorkgroups(...N)}x.setPipeline(f),x.setBindGroup(0,w),x.dispatchWorkgroups(Math.ceil(T[0]/32),T[1],1),x.end()})},Ee=(t,e,a)=>{const s=Array(512),n=a.slice().sort((l,m)=>l.at-m.at).map(l=>({rgb:k(l.color),arrayIndex:Math.floor(Math.max(Math.min(1,l.at),0)*(512-1))}));n.unshift({rgb:n[0].rgb,arrayIndex:0}),n.push({rgb:n[n.length-1].rgb,arrayIndex:512-1}),n.forEach((l,m)=>{if(s[l.arrayIndex]=l.rgb.slice(),m+1<n.length){const u=n[m+1],p=u.arrayIndex-l.arrayIndex;for(let P=0;P<p;P++){const h=P/p;s[l.arrayIndex+P]=[l.rgb[0]*(1-h)+u.rgb[0]*h,l.rgb[1]*(1-h)+u.rgb[1]*h,l.rgb[2]*(1-h)+u.rgb[2]*h]}}});const c=t.createBuffer({size:(3+1)*512*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,mappedAtCreation:!0}),o=new Float32Array(c.getMappedRange());for(let l=0;l<s.length;l++)o.set(s[l],(3+1)*l);return c.unmap(),c},ie=({config:t,device:e,timeBuffer:a})=>{const r=e.createSampler({magFilter:"linear",minFilter:"linear"});let s,n,c,o,l,m;const u=[F(e,"src/matrix/shaders/wgsl/palettePass.wgsl")],p=(async()=>{const[d]=await Promise.all(u);s=await e.createComputePipelineAsync({layout:"auto",compute:{module:d.module,entryPoint:"computeMain"}});const g=V.from(d.code),f=g.Config;n=A(e,f,{ditherMagnitude:t.ditherMagnitude,backgroundColor:k(t.backgroundColor),cursorColor:k(t.cursorColor),glintColor:k(t.glintColor),cursorIntensity:t.cursorIntensity,glintIntensity:t.glintIntensity});const b=g.Palette;c=Ee(e,b,t.palette)})();return z("Palette",p,(d,g)=>(l==null||l.destroy(),l=D(e,d),m=d,o=I(e,s,0,[n,c,a,r,g.primary.createView(),g.bloom.createView(),l.createView()]),{primary:l}),(d,g)=>{if(!g)return;const f=d.beginComputePass();f.setPipeline(s),f.setBindGroup(0,o),f.dispatchWorkgroups(Math.ceil(m[0]/32),m[1],1),f.end()})},Ge=[{space:"rgb",values:[.36,.81,.98]},{space:"rgb",values:[.96,.66,.72]},{space:"rgb",values:[1,1,1]},{space:"rgb",values:[.96,.66,.72]},{space:"rgb",values:[.36,.81,.98]}].map(t=>Array(3).fill(t)).flat(1),Me=[{space:"rgb",values:[.89,.01,.01]},{space:"rgb",values:[1,.55,0]},{space:"rgb",values:[1,.93,0]},{space:"rgb",values:[0,.5,.15]},{space:"rgb",values:[0,.3,1]},{space:"rgb",values:[.46,.03,.53]}].map(t=>Array(2).fill(t)).flat(1),H=({config:t,device:e,timeBuffer:a})=>{const r="stripeColors"in t?t.stripeColors:t.effect==="pride"?Me:Ge,s=Te(e,r.map(f=>[...k(f),1])),n=e.createSampler({magFilter:"linear",minFilter:"linear"});let c,o,l,m,u,p;const P=[F(e,"src/matrix/shaders/wgsl/stripePass.wgsl")],h=(async()=>{const[f]=await Promise.all(P);c=await e.createComputePipelineAsync({layout:"auto",compute:{module:f.module,entryPoint:"computeMain"}});const b=V.from(f.code).Config;o=A(e,b,{ditherMagnitude:t.ditherMagnitude,backgroundColor:k(t.backgroundColor),cursorColor:k(t.cursorColor),glintColor:k(t.glintColor),cursorIntensity:t.cursorIntensity,glintIntensity:t.glintIntensity})})();return z("Stripe",h,(f,b)=>(u==null||u.destroy(),u=D(e,f),p=f,l=b.primary,m=b.bloom,{primary:u}),(f,b)=>{if(!b)return;const w=f.beginComputePass();w.setPipeline(c);const y=I(e,c,0,[o,a,n,l.createView(),m.createView(),s.createView(),u.createView()]);w.setBindGroup(0,y),w.dispatchWorkgroups(Math.ceil(p[0]/32),p[1],1),w.end()})},Ae="https://upload.wikimedia.org/wikipedia/commons/thumb/0/0a/Flammarion_Colored.jpg/917px-Flammarion_Colored.jpg",Ie=({config:t,device:e})=>{const a="bgURL"in t?t.bgURL:Ae,r=[$(e,a),F(e,"src/matrix/shaders/wgsl/imagePass.wgsl")],s=e.createSampler({magFilter:"linear",minFilter:"linear"});let n,c,o,l,m,u;const p=(async()=>{const[d,g]=await Promise.all(r);m=d,n=await e.createComputePipelineAsync({layout:"auto",compute:{module:g.module,entryPoint:"computeMain"}});const f=V.from(g.code).Config;c=A(e,f,{unused:0})})();return z("Image",p,(d,g)=>(o==null||o.destroy(),o=D(e,d),l=d,u=I(e,n,0,[c,s,g.primary.createView(),g.bloom.createView(),m.createView(),o.createView()]),{primary:o}),(d,g)=>{if(!g)return;const f=d.beginComputePass();f.setPipeline(n),f.setBindGroup(0,u),f.dispatchWorkgroups(Math.ceil(l[0]/32),l[1],1),f.end()})};let pe;const fe=5,j=Array(fe).fill().map(t=>[0,0,-1/0,0]);let W=0,K=!0;window.onclick=t=>{j[W][0]=0+t.clientX/t.srcElement.clientWidth,j[W][1]=1-t.clientY/t.srcElement.clientHeight,j[W][2]=(Date.now()-pe)/1e3,W=(W+1)%fe,K=!0};const Re=({config:t,device:e,cameraTex:a,cameraAspectRatio:r,timeBuffer:s})=>{const n=[F(e,"src/matrix/shaders/wgsl/mirrorPass.wgsl")],c=e.createSampler({magFilter:"linear",minFilter:"linear"});let o,l,m,u,p,P,h,d,g;const f=(async()=>{const[y]=await Promise.all(n);o=await e.createComputePipelineAsync({layout:"auto",compute:{module:y.module,entryPoint:"computeMain"}});const T=V.from(y.code),S=T.Config;l=A(e,S,{unused:0}),m=T.Scene,u=A(e,m),p=T.Touches,P=A(e,p)})(),b=(y,T)=>{h==null||h.destroy(),h=D(e,y),d=y,y[0]/y[1],g=I(e,o,0,[l,s,u,P,c,T.primary.createView(),T.bloom.createView(),a.createView(),h.createView()]);const S=y[0]/y[1];return e.queue.writeBuffer(u,0,m.toBuffer({screenAspectRatio:S,cameraAspectRatio:r})),{primary:h}},w=(y,T)=>{if(!T)return;K&&(K=!1,e.queue.writeBuffer(P,0,p.toBuffer({touches:j})));const S=y.beginComputePass();S.setPipeline(o),S.setBindGroup(0,g),S.dispatchWorkgroups(Math.ceil(d[0]/32),d[1],1),S.end()};return pe=Date.now(),z("Mirror",f,b,w)},_e=2*3,ke=({device:t,canvasFormat:e,canvasContext:a})=>{const r=t.createSampler(),s={colorAttachments:[{loadOp:"clear",storeOp:"store"}]};let n,c;const o=[F(t,"src/matrix/shaders/wgsl/endPass.wgsl")],l=(async()=>{const[p]=await Promise.all(o);n=await t.createRenderPipelineAsync({layout:"auto",vertex:{module:p.module,entryPoint:"vertMain"},fragment:{module:p.module,entryPoint:"fragMain",targets:[{format:e}]}})})();return z("End",l,(p,P)=>(c=I(t,n,0,[r,P.primary.createView()]),null),(p,P)=>{if(!P)return;s.colorAttachments[0].view=a.getCurrentTexture().createView();const h=p.beginRenderPass(s);h.setPipeline(n),h.setBindGroup(0,c),h.draw(_e,1,0,0),h.end()})},Ve=t=>new Promise((e,a)=>{const r=document.createElement("script");r.onload=e,r.onerror=a,r.src=t,document.body.appendChild(r)}),ue={none:null,plain:ie,palette:ie,customStripes:H,stripes:H,pride:H,transPride:H,trans:H,image:Ie,mirror:Re},ze=async(t,e)=>{await Ve("lib/gl-matrix.js"),(document.fullscreenEnabled||document.webkitFullscreenEnabled)&&(window.ondblclick=()=>{document.fullscreenElement==null?t.webkitRequestFullscreen!=null?t.webkitRequestFullscreen():t.requestFullscreen():document.exitFullscreen()}),e.useCamera&&await de();const a=navigator.gpu.getPreferredCanvasFormat(),r=await navigator.gpu.requestAdapter(),s=await r.requestDevice(),n=t.getContext("webgpu");n.configure({device:s,format:a,alphaMode:"opaque",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_DST});const c=V.from("struct Time { seconds : f32, frames : i32, };").Time,o=A(s,c),l=s.createTexture({size:Q,format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT}),m={config:e,adapter:r,device:s,canvasContext:n,timeBuffer:o,canvasFormat:a,cameraTex:l,cameraAspectRatio:ge,cameraSize:Q},u=e.effect in ue?e.effect:"palette",p=await we(m,[Ue,Ce,ue[u],ke]),P=1e3/e.fps;let h=0,d=NaN,g=NaN;const f=b=>{isNaN(d)&&(d=b),isNaN(g)&&(g=d);const w=e.fps>=60||b-g>=P||e.once;if(w)for(;b-P>g;)g+=P;const y=window.devicePixelRatio??1,T=Math.ceil(t.clientWidth*y*e.resolution),S=Math.ceil(t.clientHeight*y*e.resolution),Y=[T,S];(t.width!==T||t.height!==S)&&(t.width=T,t.height=S,p.build(Y)),e.useCamera&&s.queue.copyExternalImageToTexture({source:Pe},{texture:l},Q),s.queue.writeBuffer(o,0,c.toBuffer({seconds:(b-d)/1e3,frames:h})),h++;const O=s.createCommandEncoder();p.run(O,w),s.queue.submit([O.finish()]),e.once||requestAnimationFrame(f)};requestAnimationFrame(f)};export{ze as default};
//# sourceMappingURL=main-555fd0c5.js.map
