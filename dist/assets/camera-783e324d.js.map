{"version":3,"file":"camera-783e324d.js","sources":["../../src/matrix/js/colorToRGB.js","../../src/matrix/js/camera.js"],"sourcesContent":["export default ({ space, values }) => {\n\tif (space === \"rgb\") {\n\t\treturn values;\n\t}\n\tconst [hue, saturation, lightness] = values;\n\tconst a = saturation * Math.min(lightness, 1 - lightness);\n\tconst f = (n) => {\n\t\tconst k = (n + hue * 12) % 12;\n\t\treturn lightness - a * Math.max(-1, Math.min(k - 3, 9 - k, 1));\n\t};\n\treturn [f(0), f(8), f(4)];\n};\n","// TODO: switch to video-based texture\n// TODO: mipmap?\nconst video = document.createElement(\"video\");\nconst cameraCanvas = document.createElement(\"canvas\");\ncameraCanvas.width = 1;\ncameraCanvas.height = 1;\nconst context = cameraCanvas.getContext(\"2d\");\nlet cameraAspectRatio = 1.0;\nconst cameraSize = [1, 1];\n\nconst drawToCanvas = () => {\n\trequestAnimationFrame(drawToCanvas);\n\tcontext.drawImage(video, 0, 0);\n};\n\nconst setupCamera = async () => {\n\ttry {\n\t\tconst stream = await navigator.mediaDevices.getUserMedia({\n\t\t\tvideo: {\n\t\t\t\twidth: { min: 800, ideal: 1280 },\n\t\t\t\tframeRate: { ideal: 60 },\n\t\t\t},\n\t\t\taudio: false,\n\t\t});\n\t\tconst videoTrack = stream.getVideoTracks()[0];\n\t\tconst { width, height } = videoTrack.getSettings();\n\n\t\tvideo.width = width;\n\t\tvideo.height = height;\n\t\tcameraCanvas.width = width;\n\t\tcameraCanvas.height = height;\n\t\tcameraAspectRatio = width / height;\n\t\tcameraSize[0] = width;\n\t\tcameraSize[1] = height;\n\n\t\tvideo.srcObject = stream;\n\t\tvideo.play();\n\n\t\tdrawToCanvas();\n\t} catch (e) {\n\t\tconsole.warn(`Camera not initialized: ${e}`);\n\t}\n};\n\nexport { cameraCanvas, cameraAspectRatio, cameraSize, setupCamera };\n"],"names":["colorToRGB","space","values","hue","saturation","lightness","a","f","n","k","video","cameraCanvas","context","cameraAspectRatio","cameraSize","drawToCanvas","setupCamera","stream","videoTrack","width","height","e"],"mappings":"AAAA,MAAAA,EAAe,CAAC,CAAE,MAAAC,EAAO,OAAAC,KAAa,CACrC,GAAID,IAAU,MACb,OAAOC,EAER,KAAM,CAACC,EAAKC,EAAYC,CAAS,EAAIH,EAC/BI,EAAIF,EAAa,KAAK,IAAIC,EAAW,EAAIA,CAAS,EAClDE,EAAKC,GAAM,CAChB,MAAMC,GAAKD,EAAIL,EAAM,IAAM,GAC3B,OAAOE,EAAYC,EAAI,KAAK,IAAI,GAAI,KAAK,IAAIG,EAAI,EAAG,EAAIA,EAAG,CAAC,CAAC,CAC/D,EACC,MAAO,CAACF,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,CAAC,CACzB,ECTMG,EAAQ,SAAS,cAAc,OAAO,EACtCC,EAAe,SAAS,cAAc,QAAQ,EACpDA,EAAa,MAAQ,EACrBA,EAAa,OAAS,EACtB,MAAMC,EAAUD,EAAa,WAAW,IAAI,EACzC,IAACE,EAAoB,EACnB,MAACC,EAAa,CAAC,EAAG,CAAC,EAElBC,EAAe,IAAM,CAC1B,sBAAsBA,CAAY,EAClCH,EAAQ,UAAUF,EAAO,EAAG,CAAC,CAC9B,EAEMM,EAAc,SAAY,CAC/B,GAAI,CACH,MAAMC,EAAS,MAAM,UAAU,aAAa,aAAa,CACxD,MAAO,CACN,MAAO,CAAE,IAAK,IAAK,MAAO,IAAM,EAChC,UAAW,CAAE,MAAO,EAAI,CACxB,EACD,MAAO,EACV,CAAG,EACKC,EAAaD,EAAO,eAAgB,EAAC,CAAC,EACtC,CAAE,MAAAE,EAAO,OAAAC,CAAQ,EAAGF,EAAW,YAAW,EAEhDR,EAAM,MAAQS,EACdT,EAAM,OAASU,EACfT,EAAa,MAAQQ,EACrBR,EAAa,OAASS,EACtBP,EAAoBM,EAAQC,EAC5BN,EAAW,CAAC,EAAIK,EAChBL,EAAW,CAAC,EAAIM,EAEhBV,EAAM,UAAYO,EAClBP,EAAM,KAAI,EAEVK,GACA,OAAQM,EAAG,CACX,QAAQ,KAAK,2BAA2BA,CAAC,EAAE,CAC3C,CACF"}