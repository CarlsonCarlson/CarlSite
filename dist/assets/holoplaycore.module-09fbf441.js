var z=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function G(w,e){return e={exports:{}},w(e,e.exports),e.exports}var P=G(function(w){(function(e,n){var l=Math.pow(2,-24),a=Math.pow(2,32),c=Math.pow(2,53);function f(m){var y=new ArrayBuffer(256),q=new DataView(y),M,h=0;function d(t){for(var o=y.byteLength,r=h+t;o<r;)o*=2;if(o!==y.byteLength){var s=q;y=new ArrayBuffer(o),q=new DataView(y);for(var p=h+3>>2,i=0;i<p;++i)q.setUint32(i*4,s.getUint32(i*4))}return M=t,q}function k(){h+=M}function O(t){k(d(8).setFloat64(h,t))}function x(t){k(d(1).setUint8(h,t))}function L(t){for(var o=d(t.length),r=0;r<t.length;++r)o.setUint8(h+r,t[r]);k()}function g(t){k(d(2).setUint16(h,t))}function C(t){k(d(4).setUint32(h,t))}function B(t){var o=t%a,r=(t-o)/a,s=d(8);s.setUint32(h,r),s.setUint32(h+4,o),k()}function R(t,o){o<24?x(t<<5|o):o<256?(x(t<<5|24),x(o)):o<65536?(x(t<<5|25),g(o)):o<4294967296?(x(t<<5|26),C(o)):(x(t<<5|27),B(o))}function A(t){var o;if(t===!1)return x(244);if(t===!0)return x(245);if(t===null)return x(246);if(t===n)return x(247);switch(typeof t){case"number":if(Math.floor(t)===t){if(0<=t&&t<=c)return R(0,t);if(-c<=t&&t<0)return R(1,-(t+1))}return x(251),O(t);case"string":var r=[];for(o=0;o<t.length;++o){var s=t.charCodeAt(o);s<128?r.push(s):s<2048?(r.push(192|s>>6),r.push(128|s&63)):s<55296?(r.push(224|s>>12),r.push(128|s>>6&63),r.push(128|s&63)):(s=(s&1023)<<10,s|=t.charCodeAt(++o)&1023,s+=65536,r.push(240|s>>18),r.push(128|s>>12&63),r.push(128|s>>6&63),r.push(128|s&63))}return R(3,r.length),L(r);default:var p;if(Array.isArray(t))for(p=t.length,R(4,p),o=0;o<p;++o)A(t[o]);else if(t instanceof Uint8Array)R(2,t.length),L(t);else{var i=Object.keys(t);for(p=i.length,R(5,p),o=0;o<p;++o){var u=i[o];A(u),A(t[u])}}}}if(A(m),"slice"in y)return y.slice(0,h);for(var S=new ArrayBuffer(h),F=new DataView(S),V=0;V<h;++V)F.setUint8(V,q.getUint8(V));return S}function b(m,y,q){var M=new DataView(m),h=0;typeof y!="function"&&(y=function(r){return r}),typeof q!="function"&&(q=function(){return n});function d(r,s){return h+=s,r}function k(r){return d(new Uint8Array(m,h,r),r)}function O(){var r=new ArrayBuffer(4),s=new DataView(r),p=C(),i=p&32768,u=p&31744,D=p&1023;if(u===31744)u=261120;else if(u!==0)u+=127-15<<10;else if(D!==0)return D*l;return s.setUint32(0,i<<16|u<<13|D<<13),s.getFloat32(0)}function x(){return d(M.getFloat32(h),4)}function L(){return d(M.getFloat64(h),8)}function g(){return d(M.getUint8(h),1)}function C(){return d(M.getUint16(h),2)}function B(){return d(M.getUint32(h),4)}function R(){return B()*a+B()}function A(){return M.getUint8(h)!==255?!1:(h+=1,!0)}function S(r){if(r<24)return r;if(r===24)return g();if(r===25)return C();if(r===26)return B();if(r===27)return R();if(r===31)return-1;throw"Invalid length encoding"}function F(r){var s=g();if(s===255)return-1;var p=S(s&31);if(p<0||s>>5!==r)throw"Invalid indefinite length element";return p}function V(r,s){for(var p=0;p<s;++p){var i=g();i&128&&(i<224?(i=(i&31)<<6|g()&63,s-=1):i<240?(i=(i&15)<<12|(g()&63)<<6|g()&63,s-=2):(i=(i&15)<<18|(g()&63)<<12|(g()&63)<<6|g()&63,s-=3)),i<65536?r.push(i):(i-=65536,r.push(55296|i>>10),r.push(56320|i&1023))}}function t(){var r=g(),s=r>>5,p=r&31,i,u;if(s===7)switch(p){case 25:return O();case 26:return x();case 27:return L()}if(u=S(p),u<0&&(s<2||6<s))throw"Invalid length";switch(s){case 0:return u;case 1:return-1-u;case 2:if(u<0){for(var D=[],j=0;(u=F(s))>=0;)j+=u,D.push(k(u));var T=new Uint8Array(j),_=0;for(i=0;i<D.length;++i)T.set(D[i],_),_+=D[i].length;return T}return k(u);case 3:var W=[];if(u<0)for(;(u=F(s))>=0;)V(W,u);else V(W,u);return String.fromCharCode.apply(null,W);case 4:var I;if(u<0)for(I=[];!A();)I.push(t());else for(I=new Array(u),i=0;i<u;++i)I[i]=t();return I;case 5:var E={};for(i=0;i<u||u<0&&!A();++i){var H=t();E[H]=t()}return E;case 6:return y(t(),u);case 7:switch(u){case 20:return!1;case 21:return!0;case 22:return null;case 23:return n;default:return q(u)}}}var o=t();if(h!==m.byteLength)throw"Remaining bytes";return o}var v={encode:f,decode:b};typeof n=="function"&&n.amd?n("cbor/cbor",v):w.exports?w.exports=v:e.CBOR||(e.CBOR=v)})(z)});/**
 * This files defines the HoloPlayClient class and Message class.
 *
 * Copyright (c) [2019] [Looking Glass Factory]
 *
 * @link    https://lookingglassfactory.com/
 * @file    This files defines the HoloPlayClient class and Message class.
 * @author  Looking Glass Factory.
 * @version 0.0.8
 * @license SEE LICENSE IN LICENSE.md
 */const J=typeof window>"u"?require("ws"):window.WebSocket;class X{constructor(e,n,l,a=!1,c,f,b){this.reqs=[],this.reps=[],this.requestId=this.getRequestId(),this.debug=a,this.isGreedy=f,this.errCallback=n,this.closeCallback=l,this.alwaysdebug=!1,this.isConnected=!1;let v=null;c||f||b?v=new K(c,f,b,this.debug):(a&&(this.alwaysdebug=!0),typeof e=="function"&&(v=new N)),this.openWebsocket(v,e)}sendMessage(e,n=60){this.alwaysdebug&&(e.cmd.debug=!0);let l=e.toCbor();return this.sendRequestObj(l,n)}disconnect(){this.ws.close()}openWebsocket(e=null,n=null){this.ws=new J("ws://localhost:11222/driver",["rep.sp.nanomsg.org"]),this.ws.parent=this,this.ws.binaryType="arraybuffer",this.ws.onmessage=this.messageHandler,this.ws.onopen=()=>{this.isConnected=!0,this.debug&&console.log("socket open"),e!=null&&this.sendMessage(e).then(n)},this.ws.onerror=this.onSocketError,this.ws.onclose=this.onClose}sendRequestObj(e,n){return new Promise((l,a)=>{let c={id:this.requestId++,parent:this,payload:e,success:l,error:a,send:function(){this.debug&&console.log("attemtping to send request with ID "+this.id),this.timeout=setTimeout(c.send.bind(this),n*1e3);let f=new Uint8Array(e.byteLength+4);new DataView(f.buffer).setUint32(0,this.id),f.set(new Uint8Array(this.payload),4),this.parent.ws.send(f.buffer)}};this.reqs.push(c),c.send()})}messageHandler(e){console.log("message");let n=e.data;if(n.byteLength<4)return;let a=new DataView(n).getUint32(0);if(a<2147483648){this.parent.err("bad nng header");return}let c=this.parent.findReqIndex(a);if(c==-1){this.parent.err("got reply that doesn't match known request!");return}let f={id:a,payload:P.decode(n.slice(4))};f.payload.error==0?this.parent.reqs[c].success(f.payload):this.parent.reqs[c].error(f.payload),clearTimeout(this.parent.reqs[c].timeout),this.parent.reqs.splice(c,1),this.parent.reps.push(f),this.debug&&console.log(f.payload)}getRequestId(){return Math.floor(this.prng()*2147483647)+2147483648}onClose(e){this.parent.isConnected=!1,this.parent.debug&&console.log("socket closed"),typeof this.parent.closeCallback=="function"&&this.parent.closeCallback(e)}onSocketError(e){this.parent.debug&&console.log(e),typeof this.parent.errCallback=="function"&&this.parent.errCallback(e)}err(e){this.debug&&console.log("[DRIVER ERROR]"+e)}findReqIndex(e){let n=0;for(;n<this.reqs.length;n++)if(this.reqs[n].id==e)return n;return-1}prng(){return this.rng==null&&(this.rng=Q()),this.rng()}}class U{constructor(e,n){this.cmd=e,this.bin=n}toCbor(){return P.encode(this)}}class K extends U{constructor(e="",n=!1,l="",a=!1){let c={init:{}};e!=""&&(c.init.appid=e),l!=""&&(c.init.onclose=l),n&&(c.init.greedy=!0),a&&(c.init.debug=!0),super(c,null)}}class Y extends U{constructor(e=""){let n={delete:{name:e}};super(n,null)}}class Z extends U{constructor(e=""){let n={check:{name:e}};super(n,null)}}class $ extends U{constructor(e=null){let n={wipe:{}};e!=null&&(n.wipe.targetDisplay=e),super(n,null)}}class N extends U{constructor(){let e={info:{}};super(e,null)}}class ee extends U{constructor(){let e={uniforms:{}};super(e,bindata)}}class te extends U{constructor(){let e={shader:{}};super(e,bindata)}}class re extends U{constructor(e={vx:5,vy:9,aspect:1.6},n="",l=null){let a={show:{source:"bindata",quilt:{type:"image",settings:e}}};l!=null&&(a.show.targetDisplay=l),super(a,n)}}class ne extends U{constructor(e,n={vx:5,vy:9,aspect:1.6},l="",a=!1){let c={cache:{show:a,quilt:{name:e,type:"image",settings:n}}};super(c,l)}}class se extends U{constructor(e,n=null,l=null){let a={show:{source:"cache",quilt:{name:e}}};n!=null&&(a.show.targetDisplay=n),l!=null&&(a.show.quilt.settings=l),super(a,null)}}function Q(){function w(a){for(var c=0,f=1779033703^a.length;c<a.length;c++)f=Math.imul(f^a.charCodeAt(c),3432918353),f=f<<13|f>>>19;return function(){return f=Math.imul(f^f>>>16,2246822507),f=Math.imul(f^f>>>13,3266489909),(f^=f>>>16)>>>0}}function e(a,c,f,b){return()=>{var v=c<<9,m=a*5;return m=(m<<7|m>>>25)*9,f^=a,b^=c,c^=f,a^=b,f^=v,b=b<<11|b>>>21,(m>>>0)/4294967296}}var n=Date.now(),l=w(n.toString());return e(l(),l(),l(),l())}export{ne as CacheMessage,Z as CheckMessage,X as Client,Y as DeleteMessage,N as InfoMessage,K as InitMessage,U as Message,te as ShaderMessage,se as ShowCachedMessage,re as ShowMessage,ee as UniformsMessage,$ as WipeMessage};
//# sourceMappingURL=holoplaycore.module-09fbf441.js.map
